<html>
<head>
    <title>Projeto</title>
    <style>
        body {
            margin: 0;
        }
        canvas {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/three@<0.152.0>/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@<0.152.0>/examples/js/loaders/FBXLoader.js"></script>  
    <script src="js/three.js"></script>
    <script src="js/controls/OrbitControls.js"></script>
    <script src="js/loaders/GLTFLoader.js"></script>
    <script>
        var scene = new THREE.Scene();
        var camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);

        var renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        var controls = new THREE.OrbitControls(camera, renderer.domElement);

        //luz ambiente
        var luz_ambiente = new THREE.AmbientLight(0xffffff, 0.6); 

        //luz direcional
        var luz_direcional = new THREE.DirectionalLight(0xffff00, 0.9);

        //luz pontual do lampiao
        var luz_pontual1 = new THREE.PointLight(0xffff00, 1, 5);

        //luz pontual da vela próximo ao cavalo
        var luz_pontual2 = new THREE.PointLight(0xffff00, 1, 5);

        //luz pontual da vela em cima da casa
        var luz_pontual3 = new THREE.PointLight(0xffff00, 1, 5);

        luz_direcional.position.set(10, 1, 10);
        luz_pontual1.position.set(-4.25, 2.6, 28.4);
        luz_pontual2.position.set(-9, 2.4, 9);
        luz_pontual3.position.set(-12, 9.5, 34);

        scene.add(luz_ambiente, luz_direcional, luz_pontual1, luz_pontual2, luz_pontual3);

        //posição da camera
        camera.position.set(-10, 12, 42)       

        //chama a função de carregar os gltf/glb
        var loader= new THREE.GLTFLoader();
        
        //chamada da função para adicionar imagens ao cubo do plano de fundo
        const cube_loader = new THREE.CubeTextureLoader();
		const bg_img = cube_loader.load([
			'./img/baixo.png',
			'./img/cima.png',
			'./img/frente.png',
			'./img/tras.png',
			'./img/esquerda.png',
			'./img/direita.png',
		]);
		scene.background = bg_img;
        
        //carrega o cenario
        loader.load('assets/cena.glb', (gltf) => {
            const root = gltf.scene;
            root.position.set(38,45,35);
            scene.add(root);

        });

        //barril da loja
        loader.load('assets/baril.glb', (gltf) => {
            const root = gltf.scene; 
            root.scale.set(0.35, 0.35, 0.35);
            root.position.set(-10.5,1.65,12);
            scene.add(root);

            //barril deitado da loja
            const root2 = root.clone();
            root2.scale.set(0.35, 0.35, 0.35);
            root2.position.set(-10.5, 1.68, 11)
            root2.rotation.x = Math.PI / 2;
            root2.rotation.z = Math.PI / 2;
            scene.add(root2);

            //barril atrás da delegacia sheriff
            const root3 = root.clone();
            root3.scale.set(0.35, 0.35, 0.35);
            root3.position.set(11.6, 1.3, 13);
            scene.add(root3);
            
        })

        //carrega o cowboy da cena
        loader.load('assets/gunslinger.glb', (gltf) => {
            const root = gltf.scene; 
            root.scale.set(0.8, 0.8, 0.8);
            root.position.set(-4,2.6,28);
            root.rotation.y = Math.PI;
            scene.add(root);
               
        })
        
        //carrega o cavalo junto ao rapaz em cima dele
        loader.load('assets/cavalo.glb', (gltf) => {
            const root = gltf.scene; 
            root.scale.set(0.15, 0.15, 0.15);
            root.position.set(-4, 0.6, 7);
            root.rotation.y = Math.PI / -3;
            scene.add(root);
        })

        //carrega o conjunto de barris
        loader.load('assets/barris.glb', (gltf) => {
            const root = gltf.scene;
            root.position.set(5, 1, 4.4);
            root.scale.set(0.35, 0.35, 0.35);   
            scene.add(root);
        })

        //carrega o lampiao
        loader.load('assets/lamp.glb', (gltf) => {
            const root = gltf.scene;
            root.scale.set(0.05, 0.05, 0.05);
            root.position.set(-4.25, 2.4, 28.4);
            scene.add(root);
        })

        //carrega os fenos da cena
        loader.load('assets/tumbleweed_jumping.glb', (gltf) => {
            const feno = gltf.scene;
            feno.position.set(-14, 2, 17);
            scene.add(feno);

            //função para animar os fenos
            function animateFeno() {
                
                feno.position.x += 0.03;
                if (feno.position.x > 38) {
                    feno.position.x = -14;
                }
                feno.rotation.z += -0.05;
                
                requestAnimationFrame(animateFeno);
            }
            animateFeno(); 
        })

        loader.load('assets/tumbleweed_jumping.glb', (gltf) => {
            const feno = gltf.scene;
            feno.position.set(-40, 2, 26);
            scene.add(feno);

            
            function animateFeno() {

                feno.position.x += 0.03;
                if (feno.position.x > 6) {
                    feno.position.x = -40;
                }

                feno.rotation.z += -0.05;
                
                requestAnimationFrame(animateFeno);
            }

            animateFeno(); 
        })

        loader.load('assets/tumbleweed_jumping.glb', (gltf) => {
            const feno = gltf.scene;
            feno.position.set(-1, 2, 26);
            scene.add(feno);

            function animateFeno() {

                feno.position.x += 0.03;
                if (feno.position.x > 6) {
                    feno.position.x = -40;
                }
                feno.rotation.z += -0.05

                requestAnimationFrame(animateFeno);
            }
            animateFeno(); 
        })

        //criamos as esferas do tiro
        const geometry_esferas = new THREE.SphereGeometry(0.05, 64, 32);
		var material_esferas = new THREE.MeshPhongMaterial({
			color: 0x808080,
		});

        //adicionamos elas a um grupo
        const group_esferas = new THREE.Group();
        group_esferas.scale.set(0.5, 0.5, 0.5)
        group_esferas.position.set(-4, 3.8, 9.5);
        group_esferas.rotation.x = Math.PI/4

        //array para armazenar as esferas
        var tiros = [];

        var n_particles = 10;

        //array para armazenar o movimento das particulas
        var rates = [];

        for  (let i = 0; i < n_particles; i++){
            //cria uma nova esfera usando a geometria e material definidos
            tiros[i] = new THREE.Mesh(geometry_esferas, material_esferas);
            //define a posição inicial de cada particula
            tiros[i].position.x = Math.random()- 0.5;
            tiros[i].position.y = Math.random()- 0.5;
            tiros[i].position.z = Math.random()- 0.5;

            //define um movimento aleatorio das particulas
            rates[i] = (Math.random()+1)*0.015;
            group_esferas.add(tiros[i]);
        }
        scene.add(group_esferas);

        //chama a função para carregar textura
        const textureLoader = new THREE.TextureLoader();
        //acessamos o método .load e adicionamos a textura
        const textura_caixa = textureLoader.load('img/caixa.jpg');
        //criamos a geometria das caixas
        const geometry_caixa = new THREE.BoxGeometry(1, 1, 1);
        const material = new THREE.MeshBasicMaterial({ map: textura_caixa });
        //criamos as caixas e adicionamos a geometria e o material definido
        const caixa = new THREE.Mesh(geometry_caixa, material);
        const caixa2 = new THREE.Mesh(geometry_caixa, material);
        const caixa3 = new THREE.Mesh(geometry_caixa, material);
        
        caixa.scale.set(0.7, 0.7, 0.7);
        caixa2.scale.set(0.7, 0.7, 0.7);
        caixa3.scale.set(0.7, 0.7, 0.7);
        
        caixa.position.set(-12, 1.5, 23.4 );
        caixa2.position.set(-12.7, 1.5, 23.4 );
        caixa3.position.set(-12.4, 2.15, 23.4 );
        
        caixa.rotation.y = Math.PI/8;
        
        scene.add(caixa, caixa2, caixa3,);
        
        //criamos a geometria das madeiras da cerca 
        const geometry_madeira = new THREE.CylinderGeometry(0.6, 0.6, 8, 4);    
        const textura_madeira = textureLoader.load('img/madeira.jpg');
        const material_madeira = new THREE.MeshBasicMaterial({map: textura_madeira});
        
        //criamos as madeiras das cercas
        const madeira = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira2 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira3 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira4 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira5 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira6 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira7 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira8 = new THREE.Mesh(geometry_madeira, material_madeira);
        const madeira9 = new THREE.Mesh(geometry_madeira, material_madeira);
        
        madeira.scale.set(0.20, 0.20, 0.20);
        madeira2.scale.set(0.20, 0.20, 0.20);
        madeira3.scale.set(0.20, 0.20, 0.20);
        madeira4.scale.set(0.20, 0.20, 0.20);
        madeira5.scale.set(0.20, 0.20, 0.20);
        madeira6.scale.set(0.10, 0.4, 0.10);    
        madeira7.scale.set(0.10, 0.24, 0.10);
        madeira8.scale.set(0.10, 0.33, 0.10);
        madeira9.scale.set(0.10, 0.45, 0.10);

        madeira.position.set(-0.3, 2, -1);
        madeira2.position.set(-3, 2.5, -3);
        madeira3.position.set(-5, 2.5, -3);
        madeira4.position.set(-7.2, 2, -2);
        madeira5.position.set(-8.5, 2, 1); 
        madeira6.position.set(-7.85, 2.5, -0.5);
        madeira7.position.set(-4, 3, -3);
        madeira8.position.set(-6, 2.75, -2.55);
        madeira9.position.set(-1.65, 2.7, -2);  
        
        madeira6.rotation.y = Math.PI / -1.58;
        madeira6.rotation.z = Math.PI / 2;
        
        madeira7.rotation.z = Math.PI / 2;  
        
        madeira8.rotation.x = Math.PI / 2.4;
        madeira8.rotation.y = Math.PI / -1.12;
        madeira8.rotation.z = Math.PI / 1.62;
        
        madeira9.rotation.y = Math.PI / -16;
        madeira9.rotation.x = Math.PI / 2;
        madeira9.rotation.z = Math.PI / 1.42;
        
        scene.add(madeira,madeira2,madeira3,madeira4,madeira5,madeira6,madeira7,madeira8,madeira9)
        
        
        function criarNuvem(x, y, z, size) {
            var grupoNuvem = new THREE.Group();  

            function criarParteNuvem(x, y, z, radius) {
                var geometry = new THREE.SphereGeometry(radius, 32, 32);
                var material = new THREE.MeshBasicMaterial({ color: 0xffffff, wireframe: false });
                var esfera = new THREE.Mesh(geometry, material);
                esfera.position.set(x, y, z);
                grupoNuvem.add(esfera);
            }

            criarParteNuvem(0, 0, 0, size);   
            criarParteNuvem(3, 1, 0, size * 0.6);   
            criarParteNuvem(-3, 1, 1, size * 0.6);
            criarParteNuvem(2, -1, -3, size * 0.7);
            criarParteNuvem(-2, -1, 2, size * 0.7);  
            criarParteNuvem(0, 2, -2, size * 0.5); 

            criarParteNuvem(2.5, 1.5, 2, size * 0.5);   
            criarParteNuvem(-2.5, 1.2, -2.5, size * 0.4);
            criarParteNuvem(1, 2.2, -1.5, size * 0.6);

            grupoNuvem.scale.set(6, 4, 6); 

            grupoNuvem.position.set(x, y, z);
            scene.add(grupoNuvem);

            return grupoNuvem;  
        }

        var cloud1 = criarNuvem(50, 60, -350, 2.8);  
        var cloud2 = criarNuvem(-100, 75, 350, 2.8);
        var cloud3 = criarNuvem(100, 80, -250, 2.8);
        var cloud4 = criarNuvem(150, 75, 350, 2.8);
        var cloud5 = criarNuvem(200, 80, -200, 2.8);
        var cloud6 = criarNuvem(250, 75, -100, 2.8);
        var cloud7 = criarNuvem(300, 80, 100, 2.8);
        var cloud8 = criarNuvem(-300, 75, -50, 2.8);
        var cloud9 = criarNuvem(-250, 75, 50, 2.8);
        var cloud10 = criarNuvem(-100, 75, -350, 2.8);
        var cloud11 = criarNuvem(-150, 75, 250, 2.8);
        var cloud12 = criarNuvem(-200, 80, -300, 2.8);
        var cloud13 = criarNuvem(-250, 75, -200, 2.8);
        
        const m = new THREE.Matrix4();
		m.makeRotationY(0.0007);
        var time = 0;
        
        var animate = function () { 
            requestAnimationFrame(animate);

            time += 0.01;

            cloud1.applyMatrix4(m);
            cloud2.applyMatrix4(m);
            cloud3.applyMatrix4(m);
            cloud4.applyMatrix4(m);
            cloud5.applyMatrix4(m);
            cloud6.applyMatrix4(m);
            cloud7.applyMatrix4(m);
            cloud8.applyMatrix4(m);
            cloud9.applyMatrix4(m);
            cloud10.applyMatrix4(m);
            cloud11.applyMatrix4(m);
            cloud12.applyMatrix4(m);
            cloud13.applyMatrix4(m);
            
            //loop para animar as esferas do tiro
            for(let i = 0; i < n_particles; i++){
                //verifica se a esfera esta abaixo da altura definida, se estiver, 
                //move ela para cima com a velocidade definida
                if (tiros[i].position.y < 5){
                    tiros[i].position.y += rates[i];
                } 
                //se a esfera tiver passado a altura limite, redefine na sua origem de y
                else {
                    tiros[i].position.y = 0;
                    rates[i] = (Math.random()+1)*0.015; //define uma velocidade aleatoria para as esferas
                }
            }
            
            controls.update();
            renderer.render(scene, camera);
        };

        animate();
    </script>
</body>
</html>
